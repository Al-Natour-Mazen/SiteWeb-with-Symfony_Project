{% extends "Layouts/body.html.twig" %}

{% block main_title %}
    {{ parent() }} : Liste des Produits
{% endblock %}

{% block stylesheet %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/Vue/Products/ListProduct.css') }}" type="text/css">
{% endblock%}

{% block vue %}

    {# on inclut les informations de chaque produit dans une div masqu√©e #}
    {% for produit in produits %}
            <div id="product-info-{{ produit.id }}" class="product-info" >
                    <h2>{{ produit.libelle }}</h2>
                    <p><label>Prix unitaire :</label>{{ produit.prixUnitaire }} ‚Ç¨</p>
                    <p><label>Quantit√© en stock :</label>{{ produit.quantite }}</p><br>
                    {% if produit.description != null  %}
                        <label>Desricption :</label>
                        <p> {{ produit.description }}</p>
                    {% endif %}
                {# on creer 2 variables afin de biens s'assurer pour l envoie du formulaire  #}
                    {% set quantite_deja_commande = 0 %} {# cette variable permet de "commander" des quantites negatifs de produit et donc cela aura l'effet d'enlever le produit dans le panier et les remettre dans la BD  #}
                    {% set isporductincart = false %} {# cette variable verifier si le produit est dans le panier si ce le cas alors on affichera le formulaire pour ajouter/enlever un produit sinon on affichera pas le formulaire #}
                    {% for item in panier %} {# on parcout chaque item du panier et on verifier s'il est correspond √† l'id du produit pour init les variables #}
                        {% if item.produit.id == produit.id %}
                            {% set isporductincart = true %}
                            {% set quantite_deja_commande = item.quantite %}
                        {% endif %}
                    {% endfor %}
                    {% if produit.quantite > 0 or isporductincart%} {# s'il y a du stock ou s'il y a ce produit deja dans le panier de l'utilisateur alors on peut faire des modifications dessus #}
                        <form method="POST" action=" {{ path('order_addproduct') }}">
                                <label for="quantite">Quantit√© :</label>
                                <select id="quantite" name="quantite">
                                    {% for i in range(- quantite_deja_commande, produit.quantite ) %}
                                        <option value="{{ i }}" {% if i == 1 %}selected{% endif %}>{{ i }}</option>
                                    {% endfor %}
                                </select>
                                <input type="hidden" name="id" value="{{ produit.id }}">
                                <button id="BtnModifier" type="submit">Ajouter Au Panier</button>
                        </form>
                    {% endif %}
            </div>
    {% endfor %}

    {#  l'√©l√©ment de s√©lection qui affichera les options pour chaque produit #}
    <div id="ProductList">
        <select id="ProductSelect">
            <option value="">S√©lectionnez un produit</option>
            {% for produit in produits %}
                <option value="{{ produit.id }}">{{ produit.libelle }}</option>
            {% endfor %}
        </select>
        <div id="ProductInfo"></div>
        <h4>Vous voulez savoir combien de produits il nous reste ? c'est par <a href="{{ path('product_mail') }}">ici</a> üôÉ</h4>
    </div>

    {# l'utilisateur s√©lectionne un produit dans le menu d√©roulant, l'√©v√©nement r√©cup√©rera l'ID
    du produit s√©lectionn√© et r√©cup√©rera les informations du produit √† partir de la div masqu√©e.
    Les informations seront ensuite affich√©es dans la div #ProductInfo. Si la quantit√© en stock du produit est
    sup√©rieure √† z√©ro, le bouton "Modifier" sera √©galement affich√©. #}
    <script>
        const productSelect = document.querySelector('#ProductSelect');
        const productInfo = document.querySelector('#ProductInfo');

        productSelect.addEventListener('change', (event) => {
            const productId = event.target.value;
            if (productId === '') {
                productInfo.innerHTML = '';
                productInfo.classList.remove('has-number');
            } else {
                const productInfoDiv = document.querySelector(`#product-info-${productId}`);
                productInfo.innerHTML = productInfoDiv.innerHTML;
                productInfo.classList.add('has-number');
            }
        });
    </script>

{% endblock %}
